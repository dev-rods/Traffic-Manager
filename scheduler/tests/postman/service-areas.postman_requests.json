{
  "info": {
    "name": "Clinic Scheduler - Service-Areas Association",
    "description": "API collection for managing associations between services and areas, including per-area overrides for duration, price and pre-session instructions",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "BASE_URL",
      "value": "https://YOUR_API_GATEWAY_URL.execute-api.us-east-1.amazonaws.com",
      "type": "string"
    },
    {
      "key": "ENVIRONMENT",
      "value": "dev",
      "type": "string"
    },
    {
      "key": "API_KEY",
      "value": "YOUR_API_KEY_HERE",
      "type": "string"
    },
    {
      "key": "clinicId",
      "value": "",
      "type": "string"
    },
    {
      "key": "serviceId",
      "value": "",
      "type": "string"
    },
    {
      "key": "areaId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Associate Area to Service (basic)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "x-api-key", "value": "{{API_KEY}}", "type": "text" },
          { "key": "Content-Type", "value": "application/json", "type": "text" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"area_ids\": [\"{{areaId}}\"]\n}"
        },
        "url": {
          "raw": "{{BASE_URL}}/{{ENVIRONMENT}}/services/{{serviceId}}/areas",
          "host": ["{{BASE_URL}}"],
          "path": ["{{ENVIRONMENT}}", "services", "{{serviceId}}", "areas"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 201', function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test('Response has SUCCESS status', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.status).to.eql('SUCCESS');",
              "});",
              "",
              "pm.test('Response contains service_areas array', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.service_areas).to.be.an('array');",
              "    pm.expect(jsonData.service_areas.length).to.be.above(0);",
              "});"
            ]
          }
        }
      ],
      "response": [
        {
          "name": "Success",
          "status": "Created",
          "code": 201,
          "header": [{ "key": "Content-Type", "value": "application/json" }],
          "body": "{\n  \"status\": \"SUCCESS\",\n  \"message\": \"1 associacao(oes) criada(s) com sucesso\",\n  \"service_areas\": [\n    {\n      \"id\": \"aaa-bbb-ccc\",\n      \"service_id\": \"d4e5f6a7-b8c9-0123-defg-456789012345\",\n      \"area_id\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n      \"duration_minutes\": null,\n      \"price_cents\": null,\n      \"pre_session_instructions\": null,\n      \"active\": true,\n      \"created_at\": \"2026-02-14T10:10:00\"\n    }\n  ]\n}"
        },
        {
          "name": "Bad Request - missing area_ids",
          "status": "Bad Request",
          "code": 400,
          "header": [{ "key": "Content-Type", "value": "application/json" }],
          "body": "{\n  \"status\": \"ERROR\",\n  \"message\": \"Campo obrigatorio: area_id ou area_ids\"\n}"
        }
      ]
    },
    {
      "name": "Associate Area to Service (with overrides)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "x-api-key", "value": "{{API_KEY}}", "type": "text" },
          { "key": "Content-Type", "value": "application/json", "type": "text" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"area_id\": \"{{areaId}}\",\n  \"duration_minutes\": 45,\n  \"price_cents\": 15000,\n  \"pre_session_instructions\": \"Raspar a area 24h antes da sessao.\"\n}"
        },
        "url": {
          "raw": "{{BASE_URL}}/{{ENVIRONMENT}}/services/{{serviceId}}/areas",
          "host": ["{{BASE_URL}}"],
          "path": ["{{ENVIRONMENT}}", "services", "{{serviceId}}", "areas"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 201', function () {",
              "    pm.response.to.have.status(201);",
              "});",
              "",
              "pm.test('Response contains overrides', function () {",
              "    var jsonData = pm.response.json();",
              "    var sa = jsonData.service_areas[0];",
              "    pm.expect(sa.duration_minutes).to.eql(45);",
              "    pm.expect(sa.price_cents).to.eql(15000);",
              "    pm.expect(sa.pre_session_instructions).to.be.a('string');",
              "});"
            ]
          }
        }
      ],
      "response": [
        {
          "name": "Success with overrides",
          "status": "Created",
          "code": 201,
          "header": [{ "key": "Content-Type", "value": "application/json" }],
          "body": "{\n  \"status\": \"SUCCESS\",\n  \"message\": \"1 associacao(oes) criada(s) com sucesso\",\n  \"service_areas\": [\n    {\n      \"id\": \"aaa-bbb-ccc\",\n      \"service_id\": \"d4e5f6a7-b8c9-0123-defg-456789012345\",\n      \"area_id\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n      \"duration_minutes\": 45,\n      \"price_cents\": 15000,\n      \"pre_session_instructions\": \"Raspar a area 24h antes da sessao.\",\n      \"active\": true,\n      \"created_at\": \"2026-02-14T10:10:00\"\n    }\n  ]\n}"
        }
      ]
    },
    {
      "name": "List Service Areas",
      "request": {
        "method": "GET",
        "header": [
          { "key": "x-api-key", "value": "{{API_KEY}}", "type": "text" }
        ],
        "url": {
          "raw": "{{BASE_URL}}/{{ENVIRONMENT}}/services/{{serviceId}}/areas",
          "host": ["{{BASE_URL}}"],
          "path": ["{{ENVIRONMENT}}", "services", "{{serviceId}}", "areas"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has SUCCESS status', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.status).to.eql('SUCCESS');",
              "});",
              "",
              "pm.test('Response areas is an array', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.areas).to.be.an('array');",
              "});",
              "",
              "pm.test('Each area has effective_duration and effective_price', function () {",
              "    var jsonData = pm.response.json();",
              "    if (jsonData.areas.length > 0) {",
              "        var area = jsonData.areas[0];",
              "        pm.expect(area).to.have.property('effective_duration_minutes');",
              "        pm.expect(area).to.have.property('effective_price_cents');",
              "        pm.expect(area).to.have.property('duration_minutes');",
              "        pm.expect(area).to.have.property('price_cents');",
              "    }",
              "});"
            ]
          }
        }
      ],
      "response": [
        {
          "name": "Success",
          "status": "OK",
          "code": 200,
          "header": [{ "key": "Content-Type", "value": "application/json" }],
          "body": "{\n  \"status\": \"SUCCESS\",\n  \"areas\": [\n    {\n      \"service_area_id\": \"aaa-bbb-ccc\",\n      \"service_id\": \"d4e5f6a7-b8c9-0123-defg-456789012345\",\n      \"area_id\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n      \"name\": \"Pernas\",\n      \"display_order\": 1,\n      \"area_active\": true,\n      \"duration_minutes\": 45,\n      \"service_duration_minutes\": 30,\n      \"effective_duration_minutes\": 45,\n      \"price_cents\": 15000,\n      \"service_price_cents\": 12000,\n      \"effective_price_cents\": 15000,\n      \"pre_session_instructions\": \"Raspar a area 24h antes da sessao.\",\n      \"active\": true,\n      \"created_at\": \"2026-02-14T10:10:00\"\n    },\n    {\n      \"service_area_id\": \"ddd-eee-fff\",\n      \"service_id\": \"d4e5f6a7-b8c9-0123-defg-456789012345\",\n      \"area_id\": \"b2c3d4e5-f6a7-8901-bcde-f12345678901\",\n      \"name\": \"Axilas\",\n      \"display_order\": 2,\n      \"area_active\": true,\n      \"duration_minutes\": null,\n      \"service_duration_minutes\": 30,\n      \"effective_duration_minutes\": 30,\n      \"price_cents\": null,\n      \"service_price_cents\": 12000,\n      \"effective_price_cents\": 12000,\n      \"pre_session_instructions\": null,\n      \"active\": true,\n      \"created_at\": \"2026-02-14T10:10:00\"\n    }\n  ]\n}"
        }
      ]
    },
    {
      "name": "Update Service Area",
      "request": {
        "method": "PUT",
        "header": [
          { "key": "x-api-key", "value": "{{API_KEY}}", "type": "text" },
          { "key": "Content-Type", "value": "application/json", "type": "text" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"duration_minutes\": 60,\n  \"price_cents\": 18000,\n  \"pre_session_instructions\": \"Evitar exposicao solar 48h antes.\"\n}"
        },
        "url": {
          "raw": "{{BASE_URL}}/{{ENVIRONMENT}}/services/{{serviceId}}/areas/{{areaId}}",
          "host": ["{{BASE_URL}}"],
          "path": ["{{ENVIRONMENT}}", "services", "{{serviceId}}", "areas", "{{areaId}}"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has SUCCESS status', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.status).to.eql('SUCCESS');",
              "});",
              "",
              "pm.test('Updated fields match', function () {",
              "    var sa = pm.response.json().service_area;",
              "    pm.expect(sa.duration_minutes).to.eql(60);",
              "    pm.expect(sa.price_cents).to.eql(18000);",
              "    pm.expect(sa.pre_session_instructions).to.include('Evitar');",
              "});"
            ]
          }
        }
      ],
      "response": [
        {
          "name": "Success",
          "status": "OK",
          "code": 200,
          "header": [{ "key": "Content-Type", "value": "application/json" }],
          "body": "{\n  \"status\": \"SUCCESS\",\n  \"message\": \"Associação atualizada com sucesso\",\n  \"service_area\": {\n    \"id\": \"aaa-bbb-ccc\",\n    \"service_id\": \"d4e5f6a7-b8c9-0123-defg-456789012345\",\n    \"area_id\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n    \"duration_minutes\": 60,\n    \"price_cents\": 18000,\n    \"pre_session_instructions\": \"Evitar exposicao solar 48h antes.\",\n    \"active\": true,\n    \"created_at\": \"2026-02-14T10:10:00\"\n  }\n}"
        },
        {
          "name": "Not Found",
          "status": "Not Found",
          "code": 404,
          "header": [{ "key": "Content-Type", "value": "application/json" }],
          "body": "{\n  \"status\": \"ERROR\",\n  \"message\": \"Associação não encontrada: serviço d4e5f6a7-..., área a1b2c3d4-...\"\n}"
        },
        {
          "name": "Bad Request - no fields",
          "status": "Bad Request",
          "code": 400,
          "header": [{ "key": "Content-Type", "value": "application/json" }],
          "body": "{\n  \"status\": \"ERROR\",\n  \"message\": \"Nenhum campo para atualizar. Campos aceitos: duration_minutes, price_cents, pre_session_instructions\"\n}"
        }
      ]
    },
    {
      "name": "Update Service Area (clear overrides)",
      "request": {
        "method": "PUT",
        "header": [
          { "key": "x-api-key", "value": "{{API_KEY}}", "type": "text" },
          { "key": "Content-Type", "value": "application/json", "type": "text" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"duration_minutes\": null,\n  \"price_cents\": null,\n  \"pre_session_instructions\": null\n}"
        },
        "url": {
          "raw": "{{BASE_URL}}/{{ENVIRONMENT}}/services/{{serviceId}}/areas/{{areaId}}",
          "host": ["{{BASE_URL}}"],
          "path": ["{{ENVIRONMENT}}", "services", "{{serviceId}}", "areas", "{{areaId}}"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Overrides cleared to null', function () {",
              "    var sa = pm.response.json().service_area;",
              "    pm.expect(sa.duration_minutes).to.be.null;",
              "    pm.expect(sa.price_cents).to.be.null;",
              "    pm.expect(sa.pre_session_instructions).to.be.null;",
              "});"
            ]
          }
        }
      ],
      "response": [
        {
          "name": "Success - overrides cleared",
          "status": "OK",
          "code": 200,
          "header": [{ "key": "Content-Type", "value": "application/json" }],
          "body": "{\n  \"status\": \"SUCCESS\",\n  \"message\": \"Associação atualizada com sucesso\",\n  \"service_area\": {\n    \"id\": \"aaa-bbb-ccc\",\n    \"service_id\": \"d4e5f6a7-b8c9-0123-defg-456789012345\",\n    \"area_id\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n    \"duration_minutes\": null,\n    \"price_cents\": null,\n    \"pre_session_instructions\": null,\n    \"active\": true,\n    \"created_at\": \"2026-02-14T10:10:00\"\n  }\n}"
        }
      ]
    },
    {
      "name": "Remove Area from Service",
      "request": {
        "method": "DELETE",
        "header": [
          { "key": "x-api-key", "value": "{{API_KEY}}", "type": "text" }
        ],
        "url": {
          "raw": "{{BASE_URL}}/{{ENVIRONMENT}}/services/{{serviceId}}/areas/{{areaId}}",
          "host": ["{{BASE_URL}}"],
          "path": ["{{ENVIRONMENT}}", "services", "{{serviceId}}", "areas", "{{areaId}}"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status code is 200', function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test('Response has SUCCESS status', function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.status).to.eql('SUCCESS');",
              "});"
            ]
          }
        }
      ],
      "response": [
        {
          "name": "Success",
          "status": "OK",
          "code": 200,
          "header": [{ "key": "Content-Type", "value": "application/json" }],
          "body": "{\n  \"status\": \"SUCCESS\",\n  \"message\": \"Associacao removida com sucesso\",\n  \"service_area\": {\n    \"id\": \"aaa-bbb-ccc\",\n    \"service_id\": \"d4e5f6a7-b8c9-0123-defg-456789012345\",\n    \"area_id\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n    \"duration_minutes\": 45,\n    \"price_cents\": 15000,\n    \"pre_session_instructions\": \"Raspar a area 24h antes da sessao.\",\n    \"active\": false,\n    \"created_at\": \"2026-02-14T10:10:00\"\n  }\n}"
        },
        {
          "name": "Not Found",
          "status": "Not Found",
          "code": 404,
          "header": [{ "key": "Content-Type", "value": "application/json" }],
          "body": "{\n  \"status\": \"ERROR\",\n  \"message\": \"Associação não encontrada: serviço d4e5f6a7-..., área a1b2c3d4-...\"\n}"
        }
      ]
    }
  ]
}
